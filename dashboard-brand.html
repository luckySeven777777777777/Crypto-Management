<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>NEXBIT ç®¡ç†åå° â€” æœ€ç»ˆç‰ˆ</title>
<style>
:root{
  --top-blue:#1976d2;
  --deep-blue:#0f2655;
  --bg:#f4f7fb;
  --card:#fff;
  --red:#ff4444;
  --black:#000;
  --green:#00c851;
  --yellow:#ffbb33;
  --purple:#9933ff;
}
*{box-sizing:border-box}
body{margin:0;font-family:Segoe UI,Roboto,Arial;background:var(--bg);min-height:100vh}
.top-header{
  position:fixed;top:0;left:0;width:100%;height:64px;
  background:var(--top-blue);color:#fff;
  display:flex;align-items:center;justify-content:space-between;
  padding:0 20px;z-index:1000;
}
.top-header .brand{font-weight:700;font-size:18px}
.top-header .user{font-size:14px;display:flex;align-items:center;gap:16px}
.top-header .user a.logout-btn{
  color:white;text-decoration:none;font-size:14px;
  background: rgba(255,255,255,0.12);
  padding:6px 10px;border-radius:6px;
}
.top-header .user a.logout-btn:hover{
  background: rgba(255,255,255,0.18);
}

.app{display:flex;padding-top:64px}
.sidebar{
  width:88px;background:var(--deep-blue);color:#fff;
  min-height:calc(100vh - 64px);
  padding-top:20px;position:fixed;top:64px;left:0
}
.sidebar .icon{
  display:block;padding:16px;text-align:center;
  color:#cdd6f4;cursor:pointer
}
.sidebar .icon.active{
  background:var(--top-blue);color:#fff;
  border-radius:8px;margin:4px
}

.main{margin-left:88px;flex:1;padding:22px 26px}
.container{background:var(--card);border-radius:8px;padding:18px;box-shadow:0 6px 18px rgba(0,0,0,0.06)}
.page-title{font-size:20px;font-weight:700;margin-bottom:12px}
.grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:12px}
.card{background:#fff;border-radius:8px;padding:12px;box-shadow:0 2px 8px rgba(0,0,0,0.06);}
.filters{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin-bottom:12px}
input,select,button{padding:8px;border:1px solid #ddd;border-radius:6px}
button.primary{background:var(--top-blue);color:#fff;border:none;cursor:pointer}
.table{width:100%;border-collapse:collapse;margin-top:8px}
.table th,.table td{padding:10px;border-bottom:1px solid #eee;text-align:left;font-size:13px}
.small{font-size:12px;color:#666}
.actions button{margin-right:6px}
.footer-note{margin-top:10px;color:#888;font-size:12px}

@media(max-width:900px){
  .grid{grid-template-columns:repeat(2,1fr)}
}
</style>
</head>
<body>

<div class="top-header">
  <div class="brand">NEXBIT ç®¡ç†åå°ï¼ˆä»£ç†ï¼‰</div>
  
  <div class="user">
    å·²ç™»å½•ï¼šadmin
    <a class="logout-btn" href="logout.html">é€€å‡º</a>
  </div>
</div>

<div class="app">
  <div class="sidebar">
    <div class="icon active" data-page="dashboard" title="æ§åˆ¶å°">ğŸ </div>
    <div class="icon" data-page="recharge" title="å……å€¼ç®¡ç†">ğŸ’³</div>
    <div class="icon" data-page="withdraw" title="ææ¬¾ç®¡ç†">ğŸ’¸</div>
    <div class="icon" data-page="orders" title="è®¢å•è®°å½•">ğŸ§¾</div>
    <div class="icon" data-page="members" title="ä¼šå‘˜ç®¡ç†">ğŸ‘¥</div>
    <div class="icon" data-page="settings" title="ç³»ç»Ÿè®¾ç½®">âš™ï¸</div>
  </div>

  <div class="main">
    <!-- Dashboard -->
    <div id="page-dashboard" class="container">
      <div class="page-title">æ§åˆ¶å°</div>
      <div class="grid">
        <div class="card">ä»Šæ—¥å……å€¼<br><strong id="todayRecharge">--</strong></div>
        <div class="card">ä»Šæ—¥ææ¬¾<br><strong id="todayWithdraw">--</strong></div>
        <div class="card">ä»Šæ—¥è®¢å•<br><strong id="todayOrders">--</strong></div>
        <div class="card">é£æ§é¢„è­¦<br><strong id="alertsCount">--</strong></div>
      </div>

      <div class="container card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div class="small">ä¼šå‘˜ç­‰çº§ç»Ÿè®¡</div>
          <div class="small">æ›´æ–°äº <span id="statTime"></span></div>
        </div>
        <div style="margin-top:12px" id="memberStats"></div>
      </div>
    </div>

    <!-- Recharge page -->
    <div id="page-recharge" class="container" style="display:none">
      <div class="page-title">å……å€¼ç®¡ç†</div>
      <div class="filters">
        <label>å¼€å§‹ <input type="date" id="r_start"></label>
        <label>ç»“æŸ <input type="date" id="r_end"></label>
        <input id="r_wallet" placeholder="é’±åŒ…åœ°å€ / ä¼šå‘˜ID / è®¢å•å·" style="width:260px">
        <select id="r_currency">
          <option value="">å…¨éƒ¨å¸ç§</option>
          <option>BRL</option>
          <option>USDT</option>
          <option>BTC</option>
        </select>
        <input id="r_minCount" placeholder="é’±åŒ…å……å€¼æ¬¡æ•° >=" type="number" min="1" style="width:140px">
        <select id="r_status">
          <option value="">å…¨éƒ¨çŠ¶æ€</option>
          <option value="success">æˆåŠŸ</option>
          <option value="failed">å¤±è´¥</option>
        </select>
        <button class="primary" onclick="r_search()">æœç´¢</button>
        <button onclick="openRechargeModal()">åœ¨çº¿å……å€¼</button>
      </div>
      <table class="table">
        <thead>
          <tr><th>è®¢å•/ä¼šå‘˜/é’±åŒ…</th><th>æ—¶é—´</th><th>ç±»å‹</th><th>é‡‘é¢</th><th>å¸ç§</th><th>IP</th><th>çŠ¶æ€</th><th>æ“ä½œ</th></tr>
        </thead>
        <tbody id="r_table">
          <tr><td colspan="8" class="small">ç‚¹å‡»æœç´¢åŠ è½½æ•°æ®</td></tr>
        </tbody>
      </table>
    </div>

    <!-- Withdraw page -->
    <div id="page-withdraw" class="container" style="display:none">
      <div class="page-title">ææ¬¾ç®¡ç†</div>
      <div class="filters">
        <label>å¼€å§‹ <input type="date" id="w_start"></label>
        <label>ç»“æŸ <input type="date" id="w_end"></label>
        <input id="w_wallet" placeholder="é’±åŒ…åœ°å€ / ä¼šå‘˜ID / è®¢å•å·" style="width:260px">
        <select id="w_currency">
          <option value="">å…¨éƒ¨å¸ç§</option>
          <option>BRL</option>
          <option>USDT</option>
          <option>BTC</option>
        </select>
        <input id="w_minCount" placeholder="é’±åŒ…ææ¬¾æ¬¡æ•° >=" type="number" min="1" style="width:140px">
        <select id="w_status">
          <option value="">å…¨éƒ¨çŠ¶æ€</option>
          <option value="success">æˆåŠŸ</option>
          <option value="processing">å¤„ç†ä¸­</option>
          <option value="failed">å¤±è´¥</option>
        </select>
        <button class="primary" onclick="w_search()">æœç´¢</button>
        <button onclick="openWithdrawModal()">åœ¨çº¿ææ¬¾</button>
      </div>
      <table class="table">
        <thead>
          <tr><th>è®¢å•/ä¼šå‘˜/é’±åŒ…</th><th>æ—¶é—´</th><th>ç±»å‹</th><th>é‡‘é¢</th><th>å¸ç§</th><th>IP</th><th>çŠ¶æ€</th><th>æ“ä½œ</th></tr>
        </thead>
        <tbody id="w_table">
          <tr><td colspan="8" class="small">ç‚¹å‡»æœç´¢åŠ è½½æ•°æ®</td></tr>
        </tbody>
      </table>
    </div>

    <!-- Orders page -->
    <div id="page-orders" class="container" style="display:none">
      <div class="page-title">è®¢å•è®°å½•</div>

      <div class="filters">
        <select id="o_type">
          <option value="">å…¨éƒ¨ç±»å‹</option>
          <option value="deposit">å……å€¼</option>
          <option value="withdraw">ææ¬¾</option>
          <option value="trade">ä¹°å–äº¤æ˜“</option>
        </select>

        <select id="o_status">
          <option value="">å…¨éƒ¨çŠ¶æ€</option>
          <option value="processing">å¤„ç†ä¸­</option>
          <option value="success">å®Œæˆ</option>
          <option value="rejected">æ‹’ç»</option>
        </select>

        <input id="o_userid" placeholder="ä¼šå‘˜ID" style="width:120px">
        <input id="o_wallet" placeholder="é’±åŒ…åœ°å€ / TX Hash" style="width:180px">

        <label>å¼€å§‹ <input type="date" id="o_start"></label>
        <label>ç»“æŸ <input type="date" id="o_end"></label>

        <button class="primary" onclick="loadOrders()">æœç´¢</button>
      </div>

      <table class="table">
        <thead>
          <tr>
            <th>è®¢å•å·</th>
            <th>ä¼šå‘˜</th>
            <th>ç±»å‹</th>
            <th>å¸ç§</th>
            <th>é‡‘é¢</th>
            <th>é’±åŒ… / äº¤æ˜“å“ˆå¸Œ</th>
            <th>æ—¶é—´</th>
            <th>çŠ¶æ€</th>
            <th>æ“ä½œ</th>
          </tr>
        </thead>
        <tbody id="orders_table">
          <tr><td colspan="9" class="small">æš‚æ— è®¢å•ï¼Œç‚¹å‡»æœç´¢åŠ è½½</td></tr>
        </tbody>
      </table>

      <div style="display:flex;justify-content:center;margin-top:12px;gap:10px">
        <button onclick="prevOrdersPage()" id="orders_prev">ä¸Šä¸€é¡µ</button>
        <button onclick="nextOrdersPage()" id="orders_next">ä¸‹ä¸€é¡µ</button>
      </div>
    </div>
    
  </div><!-- main -->
</div><!-- app -->

<!-- JS -->
<script>
// ä½ ä¹‹å‰å·²æœ‰çš„ JS å’Œæˆ‘æä¾›çš„åˆ†æ­¥ JS å·²ç»åŒ…å«åœ¨è¿™é‡Œ
// å°† Part 3 å’Œ Part 4 ä¸­çš„ JavaScript é€»è¾‘ç»§ç»­åˆå¹¶å³å¯
</script>
<script>
(function(){
  // 1. ç‚¹å‡»èœå•é¡¹ï¼Œåˆ‡æ¢é¡µé¢
  const sidebar = document.querySelector(".sidebar");
  const icons = Array.from(document.querySelectorAll('.sidebar .icon'));
  
  icons.forEach(icon => {
    icon.addEventListener('click', () => {
      // åˆ‡æ¢æ¿€æ´»çŠ¶æ€
      icons.forEach(ic => ic.classList.remove('active'));
      icon.classList.add('active');
      
      // éšè—æ‰€æœ‰é¡µé¢ï¼Œæ˜¾ç¤ºé€‰ä¸­çš„é¡µé¢
      const page = icon.getAttribute('data-page');
      document.querySelectorAll('.container').forEach(c => c.style.display = 'none');
      const targetPage = document.getElementById(`page-${page}`);
      if (targetPage) targetPage.style.display = 'block';

      // å¦‚æœé¡µé¢æ˜¯â€œè®¢å•è®°å½•â€é¡µé¢ï¼ŒåŠ è½½è®¢å•æ•°æ®
      if (page === 'orders') loadOrders();
      if (page === 'dashboard') loadDashboard();
      if (page === 'recharge') r_search();
      if (page === 'withdraw') w_search();
      if (page === 'members') loadMembers();
      if (page === 'settings') loadSettings();
    });
  });

  // 2. é»˜è®¤æ¿€æ´»æ§åˆ¶å°é¡µé¢ï¼ˆå¦‚æœæ²¡æœ‰å…¶ä»–æ¿€æ´»èœå•ï¼‰
  if (!document.querySelector('.sidebar .icon.active')) {
    const defaultIcon = document.querySelector('.sidebar .icon[data-page="dashboard"]');
    if (defaultIcon) defaultIcon.classList.add('active');
    document.getElementById('page-dashboard').style.display = 'block';
  }

  // 3. åŠ è½½æ•°æ®ï¼ˆç¤ºä¾‹ï¼šæ§åˆ¶å°ï¼‰
  async function loadDashboard() {
    try {
      const res = await fetch("/api/dashboard");
      const data = await res.json();
      // å¡«å……æ•°æ®
      document.getElementById('todayRecharge').innerText = data.todayRecharge || '--';
      document.getElementById('todayWithdraw').innerText = data.todayWithdraw || '--';
      document.getElementById('todayOrders').innerText = data.todayOrders || '--';
      document.getElementById('alertsCount').innerText = data.alertsCount || '--';
      document.getElementById('statTime').innerText = new Date().toLocaleString();
    } catch (e) {
      console.error('Failed to load dashboard data', e);
    }
  }

  // 4. åŠ è½½è®¢å•è®°å½•
  async function loadOrders() {
    const tbody = document.getElementById('orders_table');
    tbody.innerHTML = '<tr><td colspan="9" class="small">åŠ è½½ä¸­...</td></tr>';

    try {
      const res = await fetch("/api/orders");
      const data = await res.json();
      if (!data || !Array.isArray(data.list)) {
        tbody.innerHTML = '<tr><td colspan="9" class="small">æ²¡æœ‰è®¢å•è®°å½•</td></tr>';
        return;
      }

      const rows = data.list.map(order => {
        return `
          <tr>
            <td>${order.orderId}</td>
            <td>${order.userid}</td>
            <td>${order.type}</td>
            <td>${order.coin}</td>
            <td>${order.amount}</td>
            <td>${order.wallet || order.txHash}</td>
            <td>${new Date(order.time).toLocaleString()}</td>
            <td>${order.status}</td>
            <td>
              <button onclick="updateOrderStatus('${order.id}', 'success')">å®Œæˆ</button>
              <button onclick="updateOrderStatus('${order.id}', 'processing')">å¤„ç†ä¸­</button>
              <button onclick="updateOrderStatus('${order.id}', 'rejected')">æ‹’ç»</button>
            </td>
          </tr>
        `;
      });

      tbody.innerHTML = rows.join('');
    } catch (e) {
      console.error('Failed to load orders', e);
    }
  }

  // 5. æ›´æ–°è®¢å•çŠ¶æ€
  async function updateOrderStatus(id, status) {
    try {
      const res = await fetch('/api/order/updateStatus', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ id, status })
      });

      const data = await res.json();
      if (data.success) {
        alert('çŠ¶æ€æ›´æ–°æˆåŠŸ');
        loadOrders(); // é‡æ–°åŠ è½½è®¢å•
      } else {
        alert('çŠ¶æ€æ›´æ–°å¤±è´¥');
      }
    } catch (e) {
      console.error('Error updating order status', e);
      alert('æ›´æ–°çŠ¶æ€æ—¶å‡ºé”™');
    }
  }

})();
</script>

</body>
</html>
